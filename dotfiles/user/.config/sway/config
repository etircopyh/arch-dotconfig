# Sway config
#
# man 5 sway

### Autostart
exec dex -a -s ~/.config/autostart
exec find ~/.config/autostart-scripts/*.sh | sh -
exec_always makoctl reload
exec_always {
    gsettings set org.gnome.desktop.interface cursor-theme  Breeze_Contrast
    gsettings set org.gnome.desktop.interface gtk-theme     Breeze-Dark
}

### Variables
#
# Logo key.
# Mod1 = Alt.
set $mod Mod4
# Vim-like directions keys
set $left   h
set $down   j
set $up     k
set $right  l
# Font
set $font_family SF Compact Display
set $font_size 9
set $bar_font_family SF Compact Display
set $bar_font_size 9

# Calculator
set $calc io.elementary.calculator
# Terminal emulator
set $term alacritty
# Dropdown terminal
set $dropdown (pgrep -a $term | grep dropdown) && \
            (swaymsg "[con_mark=dropdown] scratchpad show" || \
            swaymsg "[tiling con_mark=dropdown] move container to workspace current,move to scratchpad, scratchpad show") || \
            exec alacritty --class='dropdown'
# Browser
set $browser firefox
# Screen recorder
set $screencast wf-recorder -a -f ~/Screencasts/$(date +'%Y-%m-%d-%H:%M_screencast').mp4
set $regioncast wf-recorder -a -g "$(slurp -c '#990000FF' -s '#2F4F4F28' -b '#00000046' -d)"
# WebCam
set $webcam ffmpeg -i /dev/video0 -frames:v 1 -ss 1 ~/Photos/$(date +'%Y-%m-%d-%H:%M_webcam').png


# Application launcher
#set $menu bemenu-run -p Run: \
#            --fn 'SF Mono 9' \
#            --tb '#282A36' --tf '#ffffff' \
#            --fb '#282A36' --ff '#ffffff' \
#            --nb '#002222' --nf '#ffff21' \
#            --hb '#ffffff' --hf '#cc2132' \
#            --sb '#000000' --sf '#ffffff' \
#            --scb '#aaccff' --scf '#000000' \


# Custom application launcher (needs fzf package)
#set $launcher alacritty --class='launcher' -e $SHELL -c 'compgen -c | grep -v fzf | sort -u | fzf --layout=reverse | xargs -r swaymsg -t command exec'
set $swayfzflauncher alacritty --class='launcher' -e env TERMINAL_COMMAND="alacritty -e" sway-launcher-desktop
#set $j4-desktop-launcher alacritty --class='launcher' -e j4-dmenu-desktop --no-generic --dmenu=fzf --term='alacritty' | xargs swaymsg exec --
for_window [app_id="^launcher$"] focus, floating enable, resize set width 400 px height 500 px, border none, opacity 0.9
#bindsym --to-code $mod+y exec j4-dmenu-desktop --no-generic --dmenu='wofi --dmenu' --term=alacritty

# Screenshot
set $regionshot     grim -g \"$(slurp -c '#990000FF' -s '#2F4F4F28' -b '#00000046' -d)" - | wl-copy
set $regionshotfile grim -g \"$(slurp -c '#990000FF' -s '#2F4F4F28' -b '#00000046' -d)" ~/Screenshots/$(date +'%Y-%m-%d-%H:%M_regionshot').png
set $screenshot     grim - | wl-copy
set $screenshotfile grim ~/Screenshots/$(date +'%Y-%m-%d-%H:%M_screenshot').png

# Color picker
set $colorpick grim -g "$(slurp -p)" -t ppm - | convert - -format '%[pixel:p{0,0}]' txt:- | wl-copy

# Custom Bluetooth device chooser
set $BTconnect exec alacritty --title='Bluetooth devices' --class='BTconnect' -e $SHELL ~/.config/sway/scripts/bluetooth-prompt.sh

# Notifications
set $notify notify-send -t 3000

# Tiling
default_orientation auto

# swaynag
swaynag_command swaynag -c ~/.config/sway/swaynag

# XWayland
xwayland enable

# Title bars
default_border none

#focus_follows_mouse always

# Gaps
gaps outer 0
gaps inner 2
smart_gaps on

# Font configuration
font pango:$font_family $font_size

### Output configuration
#
output LVDS-1 {
    res 1366x768@60.022999Hz
    pos 0,0
    bg  ~/.config/sway/wallpapers/futuristic-character.jpeg fill
    subpixel none
}


### Idle configuration
#
#exec swayidle -w \
#       timeout 1200    'swaylock -f -c 000000' \
#       timeout 1800    'swaymsg "output * dpms off"' \
#           resume      'swaymsg "output * dpms on"' \
#       before-sleep    'swaylock -f -c 000000'


### Input configuration
#
    # Keyboard configuration
    input "1:1:AT_Translated_Set_2_keyboard" {
        xkb_layout  us,ru
        xkb_model   pc102
        xkb_options grp:ctrl_shift_toggle
        xkb_numlock enabled
    }

    # Mouse configuration
    input "6447:1814:Avago_USB_LaserStream(TM)_Mouse" {
        accel_profile flat
        pointer_accel 0
    }

    # TouchPad configuration
    input "2:7:SynPS/2_Synaptics_TouchPad" {
        dwt enabled
        tap enabled
        natural_scroll      disabled
        middle_emulation    disabled
        scroll_method       two_finger
    }
#
# man 5 sway-input

### Colors
#
set $bg #282A36
set $fg #eff1f5
set $br #0E0E25
set $ia #232425

# class                 border  background  text    indicator   child_border
client.focused          $br     $br         $fg     $bg         $br
client.focused_inactive $bg     $bg         $fg     $bg         $bg
client.unfocused        $bg     $bg         $fg     $bg         $bg
#client.urgent          $br     $br         $fg     $bg         $br
#client.placeholder     $br     $br         $fg     $bg         $br
#client.background              $bg

### Key bindings
#
# Basics:
#
    # Power options
    bindsym --to-code {
        $mod+Shift+z exec systemctl poweroff
        $mod+Shift+p exec systemctl reboot
        $mod+Shift+s exec systemctl suspend
    }

    # Custom launch shortcut
    bindsym XF86Launch1 exec $browser

    # Bluetooth device chooser
    bindsym --to-code $mod+Shift+b exec $BTconnect

    # Bluetooth scan
    bindsym $mod+F2 exec bluetoothctl scan on

    # Start a terminal
    bindsym {
        $mod+Return exec $term
        $mod+t      exec $term
        F9          exec $dropdown
    }

    # Kill focused window
    bindsym --to-code $mod+Shift+q kill

    # Start your launcher
#   bindsym --to-code $mod+d exec $menu
    bindsym --to-code $mod+d exec $j4-desktop-launcher
    bindsym --to-code $mod+Shift+d exec $swayfzflauncher

    # Color pick
    bindsym --to-code $mod+i exec $colorpick

    # Make a screenshot
    bindsym --release {
        Print               exec $regionshot
        $mod+Print          exec $regionshotfile
        Shift+Print         exec $screenshot
        $mod+Shift+Print    exec $screenshotfile
    }

    # Record the screen
    bindsym --release {
    	$mod+Shift+m        exec $regioncast
    	$mod+m              exec $screencast
    }

    floating_modifier $mod normal

    # Reload the configuration file
    bindsym --to-code $mod+Shift+c reload

    # Exit sway (logs you out of your session)
    bindsym --to-code $mod+Shift+e exec swaynag -c ~/.config/sway/swaynag -t warning -m 'Do you really want to exit sway? This will end your session.' -b 'Yes, exit sway' 'swaymsg exit'

#
# Moving around:
#
    # Move your focus around
    bindsym --to-code {
        $mod+$left  focus left
        $mod+$down  focus down
        $mod+$up    focus up
        $mod+$right focus right
    # Or use $mod+[up|down|left|right]
        $mod+Left   focus left
        $mod+Down   focus down
        $mod+Up     focus up
        $mod+Right  focus right
    }

    # Move the focused window
    bindsym --to-code {
        $mod+Shift+$left    move left
        $mod+Shift+$down    move down
        $mod+Shift+$up      move up
        $mod+Shift+$right   move right
    # Ditto, with arrow keys
        $mod+Shift+Left     move left
        $mod+Shift+Down     move down
        $mod+Shift+Up       move up
        $mod+Shift+Right    move right
    }

#
# Workspaces:
#
    # Switch to workspace
    bindsym {
        $mod+1 workspace number 1
        $mod+2 workspace number 2
        $mod+3 workspace number 3
        $mod+4 workspace number 4
        $mod+5 workspace number 5
        $mod+6 workspace number 6
        $mod+7 workspace number 7
        $mod+8 workspace number 8
        $mod+9 workspace number 9
        $mod+0 workspace number 10
    # Move focused container to workspace
        $mod+Shift+1 move container to workspace 1
        $mod+Shift+2 move container to workspace 2
        $mod+Shift+3 move container to workspace 3
        $mod+Shift+4 move container to workspace 4
        $mod+Shift+5 move container to workspace 5
        $mod+Shift+6 move container to workspace 6
        $mod+Shift+7 move container to workspace 7
        $mod+Shift+8 move container to workspace 8
        $mod+Shift+9 move container to workspace 9
        $mod+Shift+0 move container to workspace 10
    }

#
# Layout stuff:
#
    # Split focused window
    bindsym --to-code $mod+b splith
    bindsym --to-code $mod+v splitv

    # Switch the current container between different layout styles
    bindsym --to-code $mod+s layout stacking
    bindsym --to-code $mod+w layout tabbed
    bindsym --to-code $mod+e layout toggle split

    # Make the current focus fullscreen
    bindsym --to-code $mod+f fullscreen

    # Toggle the current focus between tiling and floating mode
    bindsym $mod+Shift+space floating toggle

    # Toggle the current focus between tiling and sticky mode
    bindsym $mod+Mod1+space sticky toggle

    # Swap focus between the tiling area and the floating area
    bindsym $mod+space focus mode_toggle

    # Move focus to the parent container
    bindsym --to-code $mod+a focus parent

#
# Scratchpad:
#
    # Move focused window to the scratchpad
    bindsym $mod+Shift+minus move scratchpad

    # Show scratchpad window
    bindsym $mod+minus scratchpad show

# TouchPad toggle
bindsym XF86TouchpadToggle input "2:7:SynPS/2_Synaptics_TouchPad" events toggle enabled disabled

# WebCam
bindsym XF86WebCam exec $webcam

# Calculator
bindsym XF86Calculator exec $calc

# Music Control
bindsym {
    XF86AudioPrev exec playerctl previous
    XF86AudioNext exec playerctl next
    XF86AudioPlay exec playerctl play-pause
    XF86AudioStop exec playerctl stop
}

# PulseAudio Control
bindsym {
    XF86AudioRaiseVolume    exec pactl set-sink-volume  @DEFAULT_SINK@ +5%
    XF86AudioLowerVolume    exec pactl set-sink-volume  @DEFAULT_SINK@ -5%
    XF86AudioMute           exec pactl set-sink-mute    @DEFAULT_SINK@ toggle
}

# Brightness Control
bindsym {
    XF86MonBrightnessDown   exec brightnessctl set 5%-
    XF86MonBrightnessUp     exec brightnessctl set 5%+
}

#
# Resizing containers:
#
mode "resize" {
    bindsym --to-code {
        $left   resize shrink   width 10px
        $down   resize grow     height 10px
        $up     resize shrink   height 10px
        $right  resize grow     width 10px

    # Ditto, with arrow keys
        Left    resize shrink   width 10px
        Down    resize grow     height 10px
        Up      resize shrink   height 10px
        Right   resize grow     width 10px
    }

    # Return to default mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

bindsym --to-code $mod+r mode "resize"

#
# Status Bar:
#
# man 5 sway-bar
bar {
    position        top
    height          20
    tray_output     none
    pango_markup    enabled
    swaybar_command waybar
#   status_command  while sh ~/.config/sway/sway_bar.sh; do sleep 1; done
#   status_command  i3blocks
#   status_command  i3status-rs ~/.config/i3status-rs/config.toml
#   separator_symbol "|"
    colors {
#       separator   #ffffff
#       statusline  #ffffff
        background  #000000
#       focused_separator   #ffffff
#       focused_statusline  #ffffff
#       focused_background  #323232
#       focused_workspace   #000000
#       active_workspace    #ffffff
#       inactive_workspace  #32323200 #32323200 #5c5c5c
#       urgent_workspace    #000000
#       binding_mode        #ffffff
    }
}


# Window rules
for_window [app_id="imv"]               floating enable
for_window [app_id="mpv"]               floating enable, sticky enable
for_window [app_id="pavucontrol-qt"]    floating enable
for_window [app_id="firefox"]           move to workspace 2
for_window [app_id="code"]              move to workspace 3
for_window [app_id="telegramdesktop"]   move to workspace 4
for_window [app_id="kotatogramdesktop"] move to workspace 4
for_window [app_id="MellowPlayer"]      move to workspace 5
# Window types
for_window [window_role="pop-up"]       floating enable
for_window [window_role="bubble"]       floating enable
for_window [window_role="task_dialog"]  floating enable
for_window [window_role="Preferences"]  floating enable

for_window [window_type="dialog"]       floating enable
for_window [window_type="menu"]         floating enable
# Custom windows
for_window [app_id="^BTconnect$"]       focus, floating enable, resize set width 450 height 300, border normal, opacity 0.95
for_window [app_id="dropdown"]          focus, floating enable, move to scratchpad, scratchpad show, sticky enable, resize set width 700 px height 400 px, move absolute position 350 px 20 px, opacity 0.95, border pixel 3, mark dropdown
for_window [app_id="htop(?i)"]          floating enable
for_window [app_id="firefox" title="Picture-in-Picture"]    floating enable, sticky enable, mark Firefox Picture-in-Picture


#
#
#include ~/.config/sway/config.d/*
